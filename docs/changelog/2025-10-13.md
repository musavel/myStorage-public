# 2025-10-13 변경사항

## 🐛 버그 수정

### 검색 필터 오작동 수정
- **문제**: 검색 옵션에 없는 필드(description 등)도 "전체" 검색 시 검색 대상에 포함됨
- **원인**: `searchField === 'all'` 일 때 `Object.values(item.metadata)`로 모든 필드를 검색
- **해결**: `searchable: true` 또는 `title` 필드만 검색하도록 수정
- **영향**: 관리자 페이지와 공개 페이지 모두 적용
- **파일**:
  - `frontend/app/admin/collections/[slug]/items/page.tsx` (190-198줄)
  - `frontend/app/collections/[slug]/page.tsx` (241-249줄)

### CSV 일괄 등록 차단 시 결과 표시 개선
- **문제**: 차단 발생 시 `remaining_urls` 배열이 너무 커서 SSE 메시지 전송 실패 (JSON 파싱 에러)
- **해결**: 토큰 기반 다운로드 시스템 구축
  - 백엔드에서 CSV 생성 후 메모리에 토큰과 함께 저장
  - 프론트엔드에는 토큰과 개수만 전송
  - 다운로드 시 토큰으로 CSV 조회
- **파일**:
  - `backend/app/services/scraper/csv_processor.py` (19-171줄)
  - `backend/app/api/scraper.py` (169-186줄)
  - `frontend/app/api/scraper/download-remaining-csv/[token]/route.ts` (신규)
  - `frontend/components/BulkImportModal.tsx` (34-37, 314-344줄)

### CSV 일괄 등록 매핑 안내 개선
- **문제**: 매핑 없이 바로 업로드하면 사용자가 매핑 설정 방법을 모를 수 있음
- **해결**: 매핑이 없으면 확인 다이얼로그 표시
  - 권장 워크플로우 안내 (단건 등록 → 매핑 저장 → CSV 일괄 등록)
  - 사용자가 확인하면 매핑 없이 진행 가능
- **파일**: `frontend/components/BulkImportModal.tsx` (126-142줄)

### DeepL API 미설정 시 컬렉션 생성 개선
- **문제**: DeepL API가 없으면 slug 자동 생성 불가하지만 안내 없이 빈 값으로 저장 시도
- **해결**:
  - 모달 열릴 때 DeepL API 가용성 체크
  - DeepL 없으면 "DeepL 번역" 버튼 숨김
  - slug 필드 필수 입력으로 변경 (빨간 테두리)
  - 경고 메시지 표시
  - 저장 시 slug 없으면 에러
- **파일**: `frontend/components/CollectionModal.tsx` (97-126, 164-171, 299-350줄)

### Next.js 15 호환성 수정
- **문제**: Next.js 15에서 동적 라우트의 `params`가 Promise로 변경되어 타입 에러
- **해결**: `params`를 `Promise<{ token: string }>`로 선언하고 `await` 사용
- **파일**:
  - `frontend/app/api/scraper/download-remaining-csv/[token]/route.ts`
  - `frontend/app/api/scraper/get-mapping/[id]/route.ts`

## 🔧 기술적 개선사항

- **검색 정확도 향상**: searchable 설정을 정확히 반영
- **SSE 페이로드 최적화**: 대용량 데이터를 토큰으로 대체
- **사용자 경험 개선**: 명확한 안내 메시지와 워크플로우 가이드
- **타입 안정성**: Next.js 15 비동기 params 대응

## 📝 영향받는 기능

- ✅ 아이템 검색 (관리자/공개 페이지)
- ✅ CSV 일괄 등록
- ✅ 차단된 URL CSV 다운로드
- ✅ 컬렉션 생성 (DeepL 없을 때)
- ✅ Next.js 15 빌드
