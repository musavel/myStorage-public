# 2025-10-10 (ëª©) - AI ì„¤ì • DB ê´€ë¦¬ & ë¬¸ì„œ êµ¬ì¡° ê°œí¸

## AI ì„¤ì • DB ê´€ë¦¬ ì‹œìŠ¤í…œ

### ë¬¸ì œ ì¸ì‹
**ê¸°ì¡´ ë°©ì‹**: localStorageì— AI ëª¨ë¸ ì„¤ì • ì €ì¥
- ë¸Œë¼ìš°ì €ë§ˆë‹¤ ë³„ë„ ì„¤ì • í•„ìš”
- localStorage ì‚­ì œ ì‹œ ì„¤ì • ì†ì‹¤
- ë‹¤ë¥¸ ê¸°ê¸°ì—ì„œ ë‹¤ì‹œ ì„¤ì •í•´ì•¼ í•¨

**ê°œì„  í•„ìš”**: DBì— ì €ì¥í•˜ì—¬ ì–´ë””ì„œë“  ë™ì¼í•œ ì„¤ì • ì‚¬ìš©

### UserSettings ëª¨ë¸ ë° í…Œì´ë¸” ì¶”ê°€
**PostgreSQL ìŠ¤í‚¤ë§ˆ** (`backend/app/models/user_settings.py`):
```python
class UserSettings(Base):
    id: int (PK)
    user_email: str (unique, indexed)  # ì†Œìœ ì ì´ë©”ì¼
    ai_text_model: str | None  # "provider/model_id" í˜•ì‹
    ai_vision_model: str | None
    created_at: datetime
    updated_at: datetime
```

**Alembic ë§ˆì´ê·¸ë ˆì´ì…˜** (`backend/alembic/versions/002_add_user_settings.py`):
- user_settings í…Œì´ë¸” ìƒì„±
- user_email ìœ ë‹ˆí¬ ì¸ë±ìŠ¤ ì¶”ê°€
- upgrade/downgrade í•¨ìˆ˜ êµ¬í˜„

**Pydantic ìŠ¤í‚¤ë§ˆ** (`backend/app/schemas/user_settings.py`):
- UserSettingsBase, UserSettingsCreate, UserSettingsUpdate, UserSettingsResponse

### ë°±ì—”ë“œ ì„¤ì • ì‹œìŠ¤í…œ ì „í™˜ (ë©”ëª¨ë¦¬ â†’ DB)
**settings.py ë¦¬íŒ©í† ë§** (`backend/app/services/ai/settings.py`):
- **Before**: ì „ì—­ ë³€ìˆ˜ `_current_ai_settings` ë”•ì…”ë„ˆë¦¬
- **After**: PostgreSQL DB ê¸°ë°˜
- `get_or_create_user_settings(db, email)`: ì‚¬ìš©ì ì„¤ì • ê°€ì ¸ì˜¤ê¸°/ìƒì„±
- `get_current_settings(db)`: DBì—ì„œ ì„¤ì • ì¡°íšŒ
- `update_settings(db, text_model, vision_model)`: DBì— ì €ì¥
- ì €ì¥ í˜•ì‹: `"openai/gpt-4o-mini"` (provider/model_id)

**field_suggestion_service.py ìˆ˜ì •**:
- `suggest_fields(db, ...)`: DB ì„¸ì…˜ íŒŒë¼ë¯¸í„° ì¶”ê°€
- `get_text_model(db)` í˜¸ì¶œë¡œ ë³€ê²½

**translation_service.py**: ë³€ê²½ ì—†ìŒ (DeepL API ì‚¬ìš©, AI ì„¤ì • ë¶ˆí•„ìš”)

### API ì—”ë“œí¬ì¸íŠ¸ DB ì—°ë™
**backend/app/api/ai.py ìˆ˜ì •**:
- `Depends(get_db)` ì£¼ì…
- `/api/ai/set-models`: `update_settings(db, ...)` í˜¸ì¶œ
- `/api/ai/get-models`: `get_current_settings(db)` í˜¸ì¶œ
- `/api/ai/suggest-fields`: DB ì„¸ì…˜ ì „ë‹¬

### í”„ë¡ íŠ¸ì—”ë“œ localStorage ì™„ì „ ì œê±°
**useAISettings í›… ê°„ì†Œí™”** (`frontend/hooks/useAISettings.ts`):

**Before**:
- localStorageì—ì„œ ë¨¼ì € ë¡œë“œ (ë¹ ë¥¸ í‘œì‹œ)
- ë°±ì—”ë“œ API í˜¸ì¶œ
- ì–‘ìª½ ë™ê¸°í™” ë¡œì§

**After**:
- localStorage ê´€ë ¨ ì½”ë“œ ì™„ì „ ì œê±°
- DBë§Œ ë‹¨ì¼ ì†ŒìŠ¤ë¡œ ì‚¬ìš© (Single Source of Truth)
- `fetchCurrentSettings()`: DBì—ì„œë§Œ ì¡°íšŒ
- `saveSettings()`: DBì—ë§Œ ì €ì¥

### ì¥ì 
- âœ… **ì—¬ëŸ¬ ë¸Œë¼ìš°ì €/ê¸°ê¸°ì—ì„œ ë™ì¼í•œ ì„¤ì •**: í•œ ë²ˆë§Œ ì„¤ì •í•˜ë©´ ë¨
- âœ… **ì„¤ì • ì†ì‹¤ ë°©ì§€**: localStorage ì‚­ì œ, ì¿ í‚¤ ì°¨ë‹¨ê³¼ ë¬´ê´€
- âœ… **ì˜êµ¬ ì €ì¥**: ì„œë²„ ì¬ì‹œì‘ í›„ì—ë„ ì„¤ì • ìœ ì§€
- âœ… **í™•ì¥ì„±**: í–¥í›„ í…Œë§ˆ, ì–¸ì–´ ë“± ë‹¤ë¥¸ ì‚¬ìš©ì ì„¤ì • ì¶”ê°€ ìš©ì´

### ë§ˆì´ê·¸ë ˆì´ì…˜
- Alembic ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± (`002_add_user_settings.py`)
- Docker ì¬ì‹œì‘ ì‹œ ìë™ ì‹¤í–‰

---

## ë¬¸ì„œ êµ¬ì¡° ê°œí¸

### ë¬¸ì„œ í†µí•© ë° ì²´ê³„í™”
**ê¸°ì¡´ ë¬¸ì œ**:
- DEVELOPMENT.mdê°€ 1300ì¤„ ì´ìƒìœ¼ë¡œ ê´€ë¦¬ ì–´ë ¤ì›€
- README.mdì— ìµœê·¼ ì—…ë°ì´íŠ¸ ì„¹ì…˜ ì¤‘ë³µ

**ìƒˆë¡œìš´ êµ¬ì¡°**:
```
docs/
â”œâ”€â”€ README.md                # ğŸ“š ë¬¸ì„œ ì¸ë±ìŠ¤
â”œâ”€â”€ ARCHITECTURE.md          # ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜
â”œâ”€â”€ changelog/               # ì¼ë³„ ë³€ê²½ ì´ë ¥
â”‚   â”œâ”€â”€ 2025-10-05.md
â”‚   â”œâ”€â”€ 2025-10-06.md
â”‚   â”œâ”€â”€ ...
â”‚   â””â”€â”€ 2025-10-10.md
â”œâ”€â”€ features/                # ê¸°ëŠ¥ë³„ ìƒì„¸ ë¬¸ì„œ
â”‚   â”œâ”€â”€ ai-models.md
â”‚   â”œâ”€â”€ web-scraping.md
â”‚   â”œâ”€â”€ field-mapping.md
â”‚   â””â”€â”€ collections.md
â””â”€â”€ guides/                  # ì‚¬ìš©ì ê°€ì´ë“œ
    â”œâ”€â”€ ai-setup.md
    â”œâ”€â”€ authentication.md
    â”œâ”€â”€ collection-examples.md
    â””â”€â”€ scraper-fields.md
```

### ARCHITECTURE.md ìƒì„±
- ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ì „ì²´ ê°œìš”
- í•˜ì´ë¸Œë¦¬ë“œ DB êµ¬ì¡°
- Service Layer Pattern
- ì¸ì¦ ì‹œìŠ¤í…œ
- AI ì‹œìŠ¤í…œ
- ì›¹ ìŠ¤í¬ë˜í•‘ ì‹œìŠ¤í…œ
- ë°ì´í„° íë¦„
- ë³´ì•ˆ ë° ì„±ëŠ¥ ê³ ë ¤ì‚¬í•­

### README.md ê°„ì†Œí™”
- ìµœê·¼ ì—…ë°ì´íŠ¸ ì„¹ì…˜ ì œê±°
- DEVELOPMENT.md ë§í¬ë¡œ ëŒ€ì²´
- í”„ë¡œì íŠ¸ ì†Œê°œì™€ ë¹ ë¥¸ ì‹œì‘ì— ì§‘ì¤‘

---

## êµë³´ë¬¸ê³  ìŠ¤í¬ë˜í•‘ ê°œì„ 

### ì¶œíŒì¼ ì¶”ì¶œ ë²„ê·¸ ìˆ˜ì •
**ë¬¸ì œ**:
- `.date` ì…€ë ‰í„°ê°€ ë¦¬ë·° ìˆ˜ì§‘ì¼ì„ ë°˜í™˜ (ì˜ˆ: 2025.09.04)
- ì›í”¼ìŠ¤ 1ê¶Œì˜ ì‹¤ì œ ì¶œíŒì¼ì€ 2021ë…„ì¸ë° ì˜ëª»ëœ ë‚ ì§œ í‘œì‹œ

**í•´ê²°**:
- `.prod_info_text.publish_date` ì…€ë ‰í„°ë¡œ ë³€ê²½
- í˜•ì‹: "ì¶œíŒì‚¬ Â· YYYYë…„ MMì›” DDì¼" (ì˜ˆ: "ëŒ€ì›ì”¨ì•„ì´ Â· 2021ë…„ 10ì›” 05ì¼")
- ì¶œíŒì‚¬ì™€ ì¶œíŒì¼ì„ ë™ì‹œì— ì¶”ì¶œ
- `Â·` ê¸°ì¤€ìœ¼ë¡œ splití•˜ì—¬ ê°ê° íŒŒì‹±

### ë‚ ì§œ í˜•ì‹ í‘œì¤€í™”
**ë³€í™˜ ë¡œì§ ì¶”ê°€**:
- ì…ë ¥: "2021ë…„ 10ì›” 05ì¼" (í•œê¸€ í¬í•¨)
- ì¶œë ¥: "2021-10-05" (ISO 8601 í˜•ì‹)
- ì •ê·œì‹: `r'(\d{4})ë…„\s*(\d{1,2})ì›”\s*(\d{1,2})ì¼'`
- ì›”/ì¼ ìë¦¿ìˆ˜ ìë™ ë³´ì • (zfill)

**ì¥ì **:
- âœ… í”„ë¡ íŠ¸ì—”ë“œ date íƒ€ì… í•„ë“œì™€ í˜¸í™˜
- âœ… ì •ë ¬/í•„í„°ë§ ìš©ì´
- âœ… êµ­ì œ í‘œì¤€ í˜•ì‹

### ë¬¸ì„œ ì—…ë°ì´íŠ¸
- `docs/guides/scraper-fields.md` ì—…ë°ì´íŠ¸
  - êµë³´ë¬¸ê³  ì¶œíŒì¼ ì˜ˆì‹œ: "2021-10-05"
  - CSS ì…€ë ‰í„° ì •ë³´ ìˆ˜ì •
  - ë‚ ì§œ ë³€í™˜ ë¡œì§ ì„¤ëª… ì¶”ê°€
