# 2025-10-05 (일)


## 📅 2025-10-05 (일) - 초기 구현
### Commit: 5e77acc (00:30)

#### 백엔드 구현
- ✅ PostgreSQL + pgVector 데이터베이스 설계
  - Collection, Book, BoardGame 테이블 (외래키 관계)
- ✅ RESTful API 구현
  - `/api/collections`, `/api/books`, `/api/board-games`
- ✅ Google OAuth 2.0 인증 시스템
  - JWT 토큰 기반 인증
  - 소유자 권한 검증 (`require_owner`)

#### 프론트엔드 구현
- ✅ Public 페이지 (조회 전용)
  - 메인: 컬렉션 카드 + 아이템 수 + 소유자 이름 개인화
  - 도서/보드게임 목록 페이지 (그리드 레이아웃)
- ✅ Admin 페이지 (로그인 UI)
- ✅ Black & White 테마 적용
- ✅ Docker 네트워크 환경 대응 (SSR/CSR 주소 자동 분기)

#### 인프라
- ✅ Docker Compose 환경 구성
- ✅ mise + uv 개발 도구 설정
- ✅ 환경변수 기반 설정 관리

#### 문서화
- ✅ README.md: 프로젝트 소개 및 빠른 시작 가이드
- ✅ DEVELOPMENT.md: 상세 개발 진행 상황 및 설계 결정 사항

---

## 📅 2025-10-05 (일) - MongoDB 하이브리드 & AI 기능
### Commit: 74166fd (13:02)

#### 1. MongoDB 하이브리드 아키텍처 구현
- ✅ PostgreSQL + MongoDB 하이브리드 구조 도입
  - PostgreSQL: 컬렉션 메타데이터 관리 (Collection 테이블)
  - MongoDB: 동적 아이템 데이터 저장 (items_* 컬렉션)
- ✅ Collection 모델에 `mongo_collection`, `field_definitions` (JSONB) 추가
- ✅ SQL Injection 방지: PostgreSQL 검증 후 MongoDB 접근
- ✅ 동적 컬렉션 CRUD API (`/api/items`) 구현
- ✅ MongoDB 컨테이너 docker-compose에 추가

#### 2. AI 기능 구현 (LangChain & LangGraph 1.0 alpha)
- ✅ AI 필드 추천 API (`/api/ai/suggest-fields`)
  - 컬렉션 이름 기반 메타데이터 자동 생성
  - OpenAI GPT 시리즈 지원 (GPT-4o Mini, GPT-4o, GPT-4.1, GPT-5 등)
  - Google Gemini 2.5 시리즈 지원 (Flash, Pro, Lite)
- ✅ AI 모델 관리 시스템
  - AIModelManager: JSON 기반 모델 데이터베이스
  - `backend/app/data/ai_models.json`: 모델 정보 및 가격 데이터
  - AI 모델 선택 API (`/api/ai/models`, `/api/ai/set-models`)
  - 비용 계산 기능

#### 3. Google OAuth 2.0 인증 완성
- ✅ 백엔드: FastAPI JWT 토큰 기반 인증
  - `/api/auth/google`: Google OAuth 로그인
  - `/api/auth/me`: 현재 사용자 정보
  - `require_owner` 의존성: 소유자 권한 검증
- ✅ 프론트엔드: React OAuth 클라이언트 통합
  - AuthContext: JWT 토큰 관리 (localStorage)
  - GoogleLogin 컴포넌트 통합
  - 로그인/로그아웃 기능

#### 4. Admin CRUD 페이지 구현
- ✅ `/admin/books`: 도서 관리 (생성/수정/삭제)
- ✅ `/admin/board-games`: 보드게임 관리 (생성/수정/삭제)
- ✅ 모달 기반 폼 UI
- ✅ API 통신 라이브러리 with 인증 헤더

#### 5. 개발 환경 및 문서
- ✅ 환경 변수 설정 (`SECRET_KEY`, `MONGO_URL`, AI API 키)
- ✅ 데이터베이스 초기화 스크립트 (`scripts/reset_database.sh`)
- ✅ COLLECTION_EXAMPLES.md: 필드 정의 예시
- ✅ AI_SETUP.md: AI 기능 설정 가이드
- ✅ DEVELOPMENT.md, README.md 업데이트

---

## 📅 2025-10-05 (일) - AI 모델 프론트엔드 & Python 3.13 업그레이드

#### 1. AI 모델 선택 프론트엔드 구현
- ✅ TypeScript 타입 정의 (`frontend/types/ai-models.ts`)
  - PricingInfo, AIModelConfig, ModelSelection, AISettings
- ✅ useAISettings 커스텀 훅 (`frontend/hooks/useAISettings.ts`)
  - localStorage ↔ 백엔드 동기화
  - 사용 가능한 모델 목록 가져오기
  - 설정 저장/로드
- ✅ ModelSelectionModal 컴포넌트 (`frontend/components/ModelSelectionModal.tsx`)
  - 텍스트/비전 모델 선택 드롭다운
  - 모델별 가격 정보 표시
  - 입력/출력 모달리티 표시
- ✅ 관리자 페이지 통합 (`/admin`)
  - "🤖 AI 모델 설정" 카드 추가
  - 현재 설정 모델 표시

#### 2. Python 3.13 업그레이드
- ✅ LangGraph 1.0 alpha 요구사항 충족
- ✅ pyproject.toml: `requires-python = ">=3.13"`
- ✅ .mise.toml: `python = "3.13"`
- ✅ .python-version: `3.13`
- ✅ Dockerfile.backend: `FROM python:3.13-slim`
- ✅ uv sync with `--prerelease=allow` (langgraph-prebuilt 설치)

#### 3. 환경 변수 구조 개선
- ✅ 데이터베이스 연결 정보를 구성 요소별로 분리
  - PostgreSQL: `POSTGRES_HOST`, `POSTGRES_PORT`, `POSTGRES_USER`, `POSTGRES_PASSWORD`, `POSTGRES_DB`
  - MongoDB: `MONGO_HOST`, `MONGO_PORT`, `MONGO_USER`, `MONGO_PASSWORD`, `MONGO_DB`
- ✅ `backend/app/core/config.py`에서 동적 URL 생성
  - `@property DATABASE_URL`: PostgreSQL 연결 URL
  - `@property MONGO_URL`: MongoDB 연결 URL
- ✅ Docker Compose 환경 변수 개별 전달
- ✅ `.env`, `.env.example` 업데이트

#### 4. 레거시 코드 비활성화
- ✅ Book, BoardGame 모델 테이블 생성 비활성화
  - `__abstract__ = True` 설정
- ✅ Collection 모델에서 relationship 주석 처리
- ✅ docker-compose.yml에 Google OAuth 환경 변수 추가

---

## 📅 2025-10-05 (일) - Service Layer 리팩토링 & 레거시 제거

#### 1. Service Layer Pattern 구현
- ✅ **서비스 레이어 아키텍처 도입**
  - API: 라우팅 및 요청/응답 처리만 담당
  - Service: 비즈니스 로직 구현
  - 서비스별 디렉토리 구조 (collection/, item/, ai/)
- ✅ **Collection Service** (`backend/app/services/collection/`)
  - collection_service.py: 컬렉션 CRUD 로직
- ✅ **Item Service** (`backend/app/services/item/`)
  - item_service.py: 아이템 CRUD 로직
- ✅ **AI Services** (`backend/app/services/ai/`)
  - settings.py: AI 설정 관리 (공통)
  - field_suggestion_service.py: 필드 추천 로직
  - model_manager_service.py: 모델 관리 로직

#### 2. SQLAlchemy 2.0 마이그레이션
- ✅ **Legacy Query API 제거**
  - `db.query(Model)` → `db.execute(select(Model))`
  - `.all()` → `.scalars().all()`
  - `.first()` → `.scalar_one_or_none()`
- ✅ 모든 API 파일 업데이트
  - collections.py, items.py, ai.py

#### 3. 레거시 코드 완전 제거
- ✅ **API 파일 삭제**
  - `backend/app/api/books.py`
  - `backend/app/api/board_games.py`
  - `backend/app/api/__init__.py`에서 임포트 제거
  - `backend/app/main.py`에서 라우터 제거
- ✅ **모델 파일 삭제**
  - `backend/app/models/book.py`
  - `backend/app/models/board_game.py`
  - `backend/app/models/__init__.py` 업데이트
- ✅ **스키마 파일 삭제**
  - `backend/app/schemas/book.py`
  - `backend/app/schemas/board_game.py`
  - `backend/app/schemas/__init__.py` 업데이트
  - `field_suggestion.py` 스키마 추가

#### 4. Gemini 2.5 모델 매핑 수정
- ✅ 잘못된 2.0 매핑 제거
  - `gemini-2.5-flash` 모델 ID 그대로 사용
  - langchain-google-genai에서 정식 지원

#### 5. 문서 업데이트
- ✅ **README.md**
  - 레거시 API 참조 제거 (books, board-games)
  - Service Layer 아키텍처 섹션 추가
  - 프로젝트 구조 업데이트 (services/ 디렉토리)
  - 라우팅 구조 간소화
- ✅ **DEVELOPMENT.md**
  - Service Layer 리팩토링 작업 기록
  - 레거시 제거 작업 기록

---

## 📅 2025-10-05 (일) - 컬렉션 관리 UI & AI 필드 추천 프론트엔드

#### 1. 컬렉션 관리 UI 구현
- ✅ **컬렉션 관리 페이지** (`/admin/collections`)
  - 컬렉션 목록 그리드 레이아웃 (1/2/3 columns)
  - 생성/편집/삭제 기능
  - 모던 카드 디자인 (hover 효과, shadow)
- ✅ **CollectionModal 컴포넌트** (`frontend/components/CollectionModal.tsx`)
  - 컬렉션 생성/수정 모달 폼
  - 이름, 슬러그, 아이콘, 설명 입력
  - 슬러그 자동 생성 (이름 기반)
  - AI 필드 추천 통합
  - 필드 정의 JSON 프리뷰
- ✅ **AIFieldSuggestion 컴포넌트** (`frontend/components/AIFieldSuggestion.tsx`)
  - AI 기반 필드 자동 추천 UI
  - 선택된 AI 모델 사용 (설정된 텍스트 모델)
  - 로딩/에러/성공 상태별 UI
  - 추천된 필드 JSON 표시 및 적용
  - 자동 제안 (모달 열릴 때)

#### 2. API 프록시 라우트 구현
- ✅ **Next.js API Routes** (클라이언트 사이드 API 호출용)
  - `/api/collections` (GET, POST)
  - `/api/collections/[id]` (GET, PUT, DELETE)
  - `/api/ai/suggest-fields` (POST)
  - 인증 토큰 전달 및 Docker 내부 네트워크 주소 사용

#### 3. 디자인 시스템 개선
- ✅ **모던 디자인 적용**
  - 그라디언트 배경: `from-gray-50 to-gray-100`, `from-purple-50 to-blue-50`
  - 그라디언트 텍스트: `bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text`
  - 카드 디자인: `rounded-xl`, `shadow-sm`, `hover:shadow-xl`
  - Hover 애니메이션: `scale-110`, `rotate-3`, `translate-x-1`
  - 아이콘 컨테이너: 그라디언트 배경 (blue, purple)
- ✅ **메인 페이지 개선** (`/`)
  - 헤더 그라디언트 배경
  - 컬렉션 카드 hover 효과 강화
- ✅ **관리자 페이지 개선** (`/admin`)
  - 사용자 아바타 그라디언트
  - 관리 카드 아이콘 그라디언트 (컬렉션: blue, AI: purple)

#### 4. 환경 설정 개선
- ✅ **docker-compose.yml 포트 환경 변수화**
  - `POSTGRES_PORT`, `MONGO_PORT` 환경 변수 지원
  - 하드코딩된 포트 제거: `"5432:5432"` → `"${POSTGRES_PORT:-5432}:5432"`
  - 포트 충돌 시 유연한 변경 가능

#### 5. 타입 정의 통합
- ✅ **frontend/lib/api.ts**
  - Collection 인터페이스에 field_definitions 추가
  - API 함수들이 타입 안전하게 작성됨

---

